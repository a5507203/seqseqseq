<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Learn & Explore Metroidvania</title>
  <style>
    body { margin: 0; overflow: hidden; font-family: sans-serif; }
    canvas { display: block; background: #87ceeb; }
    #quizModal {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center;
      visibility: hidden;
    }
    #quizContent {
      background: #fff; padding: 20px; border-radius: 8px; width: 300px;
    }
    #quizContent h3 { margin-top: 0; }
    .option { display: block; margin: 10px 0; }
    .btn { margin-top: 10px; }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="quizModal">
    <div id="quizContent">
      <h3 id="quizCategory"></h3>
      <div id="questionText"></div>
      <div id="options"></div>
      <button id="submitBtn" class="btn">Submit</button>
    </div>
  </div>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Game state
    let keys = {};
    let abilities = { fire: false, ice: false, jump: false };
    let paused = false;
    let currentOrb = null;

    // Player
    const player = { x: 50, y: canvas.height - 100, w: 40, h: 60, dx: 0, dy: 0, speed: 4, jumping: false, jumps: 0 };

    // Level objects
    const gates = [
      { x: 400, y: canvas.height - 120, w: 50, h: 120, type: 'fire' },
      { x: 800, y: canvas.height - 120, w: 50, h: 120, type: 'ice' },
      { x: 1200, y: canvas.height - 200, w: 50, h: 200, type: 'jump' }
    ];
    const orbs = [
      { x: 300, y: canvas.height - 140, r: 15, category: 'Math' },
      { x: 700, y: canvas.height - 140, r: 15, category: 'History' },
      { x: 1100, y: canvas.height - 260, r: 15, category: 'Science' }
    ];

    // Sample quizzes
    const quizzes = {
      Math: [
        { q: '2+2 = ?', opts: ['3','4','5','6'], ans: 1 },
        { q: '5*3 = ?', opts: ['15','20','10','12'], ans: 0 },
        { q: '10-7 = ?', opts: ['1','2','3','4'], ans: 2 }
      ],
      History: [
        { q: 'Who discovered America?', opts: ['Vespucci','Columbus','Magellan','Cook'], ans: 1 },
        { q: 'Year of WWII end?', opts: ['1943','1944','1945','1946'], ans: 2 },
        { q: 'First US President?', opts: ['Lincoln','Jefferson','Washington','Adams'], ans: 2 }
      ],
      Science: [
        { q: 'H2O is?', opts: ['Oxygen','Hydrogen','Water','Helium'], ans: 2 },
        { q: 'Speed of light ~?', opts: ['3e8 m/s','3e6 m/s','3e5 m/s','3e7 m/s'], ans: 0 },
        { q: 'Gravity on Earth ~?', opts: ['9.8 m/s²','10 m/s²','9 m/s²','8.9 m/s²'], ans: 0 }
      ]
    };
    let quizIndex = 0, score = 0;

    // Quiz UI
    const modal = document.getElementById('quizModal');
    const catEl = document.getElementById('quizCategory');
    const qText = document.getElementById('questionText');
    const optsEl = document.getElementById('options');
    const submitBtn = document.getElementById('submitBtn');

    submitBtn.addEventListener('click', () => {
      const selected = document.querySelector('input[name="opt"]:checked');
      if (!selected) return;
      const val = parseInt(selected.value);
      if (val === quizzes[currentOrb.category][quizIndex].ans) score++;
      quizIndex++;
      if (quizIndex < 3) loadQuiz();
      else finishQuiz();
    });

    function loadQuiz() {
      const q = quizzes[currentOrb.category][quizIndex];
      catEl.textContent = currentOrb.category + ' Quiz';
      qText.textContent = q.q;
      optsEl.innerHTML = '';
      q.opts.forEach((o,i) => {
        optsEl.innerHTML += `<label class='option'><input type='radio' name='opt' value='${i}'> ${o}</label>`;
      });
    }

    function finishQuiz() {
      modal.style.visibility = 'hidden';
      paused = false;
      if (score === 3) {
        abilities[currentOrb.type] = true;
        // remove gates and orb
        gates.forEach((g,i) => { if (g.type === currentOrb.type) gates.splice(i,1); });
        orbs.splice(orbs.indexOf(currentOrb),1);
      }
      currentOrb = null;
      quizIndex = 0; score = 0;
    }

    // Game loop
    function update() {
      if (!paused) {
        // Input
        if (keys['ArrowLeft']) player.dx = -player.speed;
        else if (keys['ArrowRight']) player.dx = player.speed;
        else player.dx = 0;
        if (keys['ArrowUp'] && (!player.jumping || (abilities.jump && player.jumps < 2))) {
          player.dy = -10; player.jumping = true; player.jumps++; }
        // Gravity
        player.dy += 0.5;
        // Position
        player.x += player.dx;
        player.y += player.dy;
        // Floor
        if (player.y + player.h > canvas.height) {
          player.y = canvas.height - player.h;
          player.dy = 0; player.jumping = false; player.jumps = 0;
        }
        // Orb collision
        orbs.forEach(o => {
          if (Math.hypot(player.x - o.x, player.y - o.y) < o.r + player.w/2) {
            pauseForQuiz(o);
          }
        });
      }
    }

    function pauseForQuiz(orb) {
      paused = true;
      currentOrb = orb;
      loadQuiz();
      modal.style.visibility = 'visible';
    }

    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      // Player
      ctx.fillStyle = 'red'; ctx.fillRect(player.x, player.y, player.w, player.h);
      // Gates
      gates.forEach(g => {
        ctx.fillStyle = g.type === 'fire' ? 'orange' : g.type === 'ice' ? 'cyan' : 'purple';
        ctx.fillRect(g.x, g.y, g.w, g.h);
      });
      // Orbs
      orbs.forEach(o => {
        ctx.beginPath(); ctx.arc(o.x, o.y, o.r,0,2*Math.PI);
        ctx.fillStyle = 'gold'; ctx.fill();
      });
    }

    function loop() { update(); draw(); requestAnimationFrame(loop); }
    loop();

    window.addEventListener('keydown', e => keys[e.key]=true);
    window.addEventListener('keyup', e => keys[e.key]=false);
  </script>
</body>
</html>
